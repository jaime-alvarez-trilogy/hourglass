<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WorkSmart — Install</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro", "Helvetica Neue", sans-serif;
      background: #0a0a0a;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .card {
      background: #1a1a1a;
      border-radius: 20px;
      padding: 40px 32px;
      max-width: 420px;
      width: 100%;
      text-align: center;
      border: 1px solid #333;
    }
    .logo {
      font-size: 64px;
      margin-bottom: 16px;
    }
    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .subtitle {
      color: #999;
      font-size: 15px;
      margin-bottom: 32px;
      line-height: 1.5;
    }
    .install-btn {
      display: inline-block;
      background: #4CAF50;
      color: white;
      text-decoration: none;
      padding: 16px 32px;
      border-radius: 14px;
      font-size: 17px;
      font-weight: 600;
      width: 100%;
      transition: background 0.2s;
    }
    .install-btn:hover { background: #43A047; }
    .prereq {
      margin-top: 16px;
      font-size: 13px;
      color: #666;
    }
    .prereq a { color: #6BA4FF; text-decoration: none; }
    .steps {
      margin-top: 32px;
      text-align: left;
      border-top: 1px solid #333;
      padding-top: 24px;
    }
    .steps h2 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #ccc;
    }
    .step {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      align-items: flex-start;
    }
    .step-num {
      background: #333;
      color: #4CAF50;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      flex-shrink: 0;
    }
    .step-text {
      font-size: 14px;
      color: #bbb;
      line-height: 1.5;
      padding-top: 3px;
    }
    .features {
      margin-top: 24px;
      border-top: 1px solid #333;
      padding-top: 24px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      text-align: left;
    }
    .feature {
      font-size: 13px;
      color: #999;
      line-height: 1.4;
    }
    .feature strong { color: #ccc; }
    .desktop-note {
      display: none;
      margin-top: 24px;
      padding: 16px;
      background: #1a1a0a;
      border: 1px solid #444400;
      border-radius: 12px;
      font-size: 14px;
      color: #cccc66;
      line-height: 1.5;
    }
    .manual-link {
      margin-top: 16px;
      font-size: 13px;
    }
    .manual-link a { color: #6BA4FF; text-decoration: none; }
  </style>
  <script>
    const SCRIPTABLE_URL = "scriptable:///run/inline?script=" +
      "const%20r%3Dnew%20Request%28%22https%3A%2F%2Fraw.githubusercontent.com%2Fjaime-alvarez-trilogy%2Fworksmart%2Fmain%2Fworksmart.js%22%29%3Bconst%20c%3Dawait%20r.loadString%28%29%3Bif%28%21c%7C%7Cc.length%3C500%29throw%20new%20Error%28%22Download%20failed%22%29%3Bconst%20f%3DFileManager.iCloud%28%29%3Bf.writeString%28f.joinPath%28f.documentsDirectory%28%29%2C%22WorkSmart.js%22%29%2Cc%29%3Bconst%20a%3Dnew%20Alert%28%29%3Ba.title%3D%22WorkSmart%20Installed%21%22%3Ba.message%3D%22Script%20added%20to%20Scriptable.%20Run%20it%20to%20set%20up%2C%20then%20add%20as%20a%20widget%20to%20your%20Home%20Screen.%22%3Ba.addAction%28%22OK%22%29%3Bawait%20a.presentAlert%28%29%3B";

    function launchScriptable(e) {
      e.preventDefault();
      var isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
      if (!isIOS) {
        document.getElementById("desktop-note").style.display = "block";
        return;
      }
      // Use hidden iframe to trigger custom URL scheme without navigation
      var iframe = document.createElement("iframe");
      iframe.style.display = "none";
      iframe.src = SCRIPTABLE_URL;
      document.body.appendChild(iframe);
      // Fallback: if iframe doesn't trigger, try window.location after brief delay
      setTimeout(function() {
        window.location.href = SCRIPTABLE_URL;
      }, 100);
      // If Scriptable isn't installed, show message after timeout
      setTimeout(function() {
        document.getElementById("no-app-note").style.display = "block";
      }, 2000);
    }

    document.addEventListener("DOMContentLoaded", function() {
      var isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
      if (!isIOS) {
        document.getElementById("desktop-note").style.display = "block";
      }
    });
  </script>
</head>
<body>
  <div class="card">
    <div class="logo">⏱️</div>
    <h1>WorkSmart</h1>
    <p class="subtitle">Crossover hours tracking & approval management — right on your Home Screen.</p>

    <a id="install-btn" href="#" class="install-btn" onclick="launchScriptable(event)">Install in Scriptable</a>

    <p class="prereq">Requires <a href="https://apps.apple.com/app/scriptable/id1405459188">Scriptable</a> (free) on your iPhone.</p>

    <div id="desktop-note" class="desktop-note">
      Open this page on your iPhone to install. The install button uses a Scriptable URL scheme that only works on iOS.
    </div>

    <div id="no-app-note" class="desktop-note" style="background:#1a0a0a;border-color:#440000;color:#cc6666;">
      Scriptable doesn't seem to be installed. <a href="https://apps.apple.com/app/scriptable/id1405459188" style="color:#6BA4FF;">Download it free from the App Store</a>, then come back and tap Install again.
    </div>

    <div class="steps">
      <h2>Setup (2 minutes)</h2>
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-text">Tap <strong>Install in Scriptable</strong> above — the script is added automatically</div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div class="step-text">Open Scriptable and run <strong>WorkSmart</strong> — the setup wizard walks you through login</div>
      </div>
      <div class="step">
        <div class="step-num">3</div>
        <div class="step-text">Long-press your Home Screen → add a <strong>Scriptable widget</strong> → choose WorkSmart</div>
      </div>
    </div>

    <div class="features">
      <div class="feature"><strong>Hours</strong><br>Weekly total, daily breakdown, earnings</div>
      <div class="feature"><strong>Approvals</strong><br>One-tap approve/reject for managers</div>
      <div class="feature"><strong>Secure</strong><br>Credentials stay in iOS Keychain</div>
      <div class="feature"><strong>Auto-updates</strong><br>Notifies when new version is out</div>
    </div>

    <div class="manual-link">
      Or install manually from <a href="https://github.com/jaime-alvarez-trilogy/worksmart">GitHub</a>
    </div>
  </div>
</body>
</html>
