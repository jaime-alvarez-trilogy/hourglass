# Crossover Widget Suite

## Folder Structure

```
WS/
  hourglass.js               â€” Unified widget (primary). Auto-adapts: hours for contributors, hours+approvals for managers
  crossover-widget.js        â€” Standalone hours-only widget (lightweight alternative)
  CLAUDE.md                  â€” This file

  docs/
    TIME_APPROVAL_README.md  â€” Feature documentation for the time approval widget
    SECURITY_IMPROVEMENTS.md â€” Security review notes (credential storage, etc.)

  tools/
    crossover-setup.js           â€” Standalone onboarding/config script (shared config system)
    crossover-widget-template.js â€” Original widget template with hardcoded credentials (deprecated)
    test-crossover-api.js        â€” Basic API test (auth, timesheet fetch)
    test-time-approval-api.js    â€” Manual time + overtime API test with multi-week validation
    test-approval-confirmed.js   â€” Tests confirmed approve/reject endpoints from reverse-engineering
    test-approval-api-discovery.js â€” Brute-force endpoint discovery for approval APIs
    test-approval-deep-probe.js  â€” Deep probe of PUT body formats for approval endpoint
    test-approval-final-probe.js â€” Final probe with different headers/content types
    test-fetch-js.js             â€” Fetch JS bundles from Crossover frontend
    test-reverse-engineer.js     â€” Reverse-engineer frontend JS for API patterns
    test-reverse-engineer2.js    â€” Extended bundle search (sizes + broad pattern match)
    test-reverse-final.js        â€” Production bundle search for approval endpoints

  assets/
    worksmart-logo.png           â€” Full-size WorkSmart logo (512x512)
    worksmart-logo-small.png     â€” Small WorkSmart logo (128x128)
    worksmart-logo.svg           â€” Vector logo source
    worksmart-logo-base64.txt    â€” Base64-encoded large logo
    logo-base64-small.txt        â€” Base64-encoded small logo
    favicon.ico                  â€” Favicon
```

## Rules

### API Documentation Rule
**Every time you discover, test, or use a Crossover API endpoint, you MUST immediately document it in `memory/MEMORY.md` under "Key API Endpoints".** This includes:
- The full URL pattern with parameter names
- HTTP method (GET, PUT, POST)
- Request body format (if applicable)
- Response format (array vs object, key field names, data types)
- Which ID to use (assignmentId vs userId vs candidateId â€” these are different!)
- Any gotchas (e.g. exact string match needed, date format, timezone behavior)

**Never assume an endpoint path.** Always check MEMORY.md first. If it's not documented there, search the codebase (`tools/test-*.js`) for prior discovery work before hitting the API blind.

### Version Bump Rule
When modifying `hourglass.js`, **always bump `SCRIPT_VERSION` and `version.json` together in the same commit.** They must match. If they don't, the auto-updater enters an infinite loop.

## Quick Reference

- **Run test scripts**: `node tools/test-crossover-api.js` (requires credentials in file)
- **Syntax check widget**: `node --check hourglass.js`
- **Config stored on device**: iOS Keychain (creds) + `crossover-config.json` (settings)
- **Cache file**: `crossover-cache.json` (failover hours data)
- **QA env**: `api-qa.crossover.com` / `app-qa.crossover.com`
- **Prod env**: `api.crossover.com` / `app.crossover.com`

<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 6, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #181 | 10:14 PM | âš–ï¸ | Widget Merge Strategy to Unify Hours Tracking and Approval Management | ~794 |
| #180 | 10:13 PM | âœ… | Simplified Team Selection in Onboarding | ~500 |
| #178 | 10:11 PM | ğŸ”„ | Onboarding Simplified with Auto-Team Selection | ~523 |
| #177 | " | ğŸ”„ | Simplified Team Selection to Auto-Select First Team | ~479 |
| #176 | " | ğŸ”„ | Simplified Team Selection to Auto-Select First Team | ~508 |
| #175 | " | ğŸŸ£ | Interactive Setup Wizard with Team Discovery and Configuration | ~577 |
| #174 | 10:02 PM | ğŸŸ£ | QA Environment Badge Added to Large Widget Display | ~505 |
| #173 | " | ğŸŸ£ | QA Environment Badge Added to Widget UI | ~460 |
| #172 | " | ğŸŸ£ | QA Environment Badge Added to Widget Display | ~452 |
| #171 | 10:01 PM | ğŸŸ£ | QA Environment Visual Indicator Added to Widget Title | ~429 |
| #170 | " | ğŸŸ£ | QA Environment Indicators Added to Widget and UITable | ~483 |
| #169 | " | ğŸŸ£ | QA Environment Badge Added to Widget Title | ~477 |
| #168 | 9:59 PM | ğŸŸ£ | Complete Onboarding System with Keychain Integration and Smart Notifications | ~848 |
| #167 | 9:57 PM | ğŸŸ£ | Hours Widget Enhanced with Onboarding Flow and Auth Recovery | ~645 |
| #166 | 9:56 PM | ğŸ”´ | Fixed Team ID Reference in Hours Widget Timesheet Query | ~386 |
| #165 | 9:55 PM | ğŸ”„ | Hours Widget Refactored to Use Shared Configuration System | ~744 |
| #164 | 9:53 PM | ğŸŸ£ | Shared Configuration System with Keychain and Onboarding | ~715 |
| #163 | " | ğŸŸ£ | Onboarding Flow and Shared Configuration System for Widgets | ~794 |
| #162 | 9:52 PM | ğŸŸ£ | Settings Button Added to Interactive Table with Reconfiguration Option | ~556 |
| #161 | " | ğŸŸ£ | Auto-Configuration Onboarding Flow Integrated with Config Management | ~719 |
| #160 | 9:48 PM | ğŸ”µ | UITable Row Structure with Three-Row Item Layout Pattern | ~668 |
| #159 | " | ğŸ”´ | Approval URL Team ID Reference Fixed to Use primaryTeamId | ~442 |
| #158 | 9:46 PM | ğŸŸ£ | Authentication Failure Triggers Config Reset for Re-onboarding | ~497 |
| #157 | 9:43 PM | ğŸŸ£ | Interactive Onboarding Flow with iOS Keychain and Shared Configuration | ~822 |
| #156 | 9:42 PM | ğŸŸ£ | Centralized Configuration and Onboarding System Created | ~789 |
| #151 | 9:33 PM | ğŸ”„ | Removed Unused Variable from Deadline Countdown Logic | ~366 |
| #150 | " | ğŸ”µ | Time Approval Widget Complete Implementation Structure | ~633 |
| #149 | 9:32 PM | ğŸŸ£ | Urgency Countdown Banner Added to Widget Display | ~197 |
| #148 | " | ğŸŸ£ | Urgency-Based Widget Background Color Theming | ~559 |
| #147 | 9:31 PM | ğŸŸ£ | Widget Display Enhanced with Category-Aware Rendering and Cost Display | ~573 |
| #146 | " | ğŸ”„ | Tiered Deadline Reminder System with Escalating Urgency | ~631 |
| #145 | 9:30 PM | ğŸŸ£ | Deadline Reminder System with Countdown Notifications | ~675 |
| #144 | 9:29 PM | ğŸŸ£ | Notification System for New Approval Requests with Persistent State Tracking | ~640 |
| #143 | 9:25 PM | ğŸŸ£ | Notification System Added for New Approval Requests | ~566 |

### Feb 7, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #294 | 9:05 AM | ğŸŸ£ | Added version.json for auto-update mechanism | ~287 |
| #292 | 9:04 AM | âœ… | Renamed primary widget to worksmart.js for professional branding | ~325 |
| #288 | 8:55 AM | âœ… | Main widget script renamed from time-approval-widget.js to worksmart.js | ~218 |
| #286 | 8:44 AM | âœ… | Image and logo assets moved to dedicated assets/ subdirectory | ~233 |
| #285 | 8:41 AM | ğŸ”µ | WS folder inventory reveals test scripts, templates, and documentation structure | ~456 |
| #283 | 8:37 AM | ğŸŸ£ | In-place table refresh system implemented using buildTableRows and table.reload() | ~448 |
| #281 | 8:34 AM | ğŸ”„ | Data fetching logic extracted into reusable fetchApprovalData function | ~373 |
| #280 | 8:33 AM | ğŸ”µ | main() function checks config.runsInWidget to determine execution context | ~348 |
| #279 | " | ğŸ”µ | Bulk approval actions already call main() for auto-refresh after completion | ~323 |
| #277 | 8:32 AM | ğŸŸ£ | Manager approval status message added to empty state bottom | ~329 |
| #276 | " | ğŸ”µ | Empty approval state includes Settings button and footer at bottom | ~363 |
| #275 | " | ğŸŸ£ | Earnings-focused view redesigned with prominent dollar amount display | ~421 |
| #274 | " | ğŸŸ£ | Manager widget header switches to earnings focus when no approvals pending | ~349 |
| #273 | 8:31 AM | ğŸ”µ | Time approval widget displays earnings-focused view for managers with no approvals | ~351 |
| #267 | 7:58 AM | ğŸŸ£ | Cache timestamp indicator in widget footer with orange "Cached:" label | ~399 |
| #262 | " | ğŸ”µ | Current error handling in crossover-widget.js main() function | ~422 |
</claude-mem-context>